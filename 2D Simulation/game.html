<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Blocks World</title>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js"></script>
    <script src="node_modules/socket.io-client/dist/socket.io.js"></script>
    <script type="text/javascript" src="index.js"></script>
    <script type="text/javascript" src="game.js"></script>
    <script type="text/javascript" src="clientConfig.js"></script>
    <script type="text/javascript" src="redirect.js"></script>
    <script type="text/javascript" src="startAndEndGame.js"></script>

    <meta charset="UTF-8">

    <meta http-equiv="pragma" content="no-cache" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="index.css">
    <link href="http://fonts.googleapis.com/css?family=Corben:bold" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Nobile" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css">
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <style>
     body {
         background: url(img/background.jpg)	no-repeat center center fixed;
         -webkit-background-size: cover;
         -moz-background-size: cover;
         -o-background-size: cover;
         background-size: cover;
     }
    </style>

  </head>

  <body oncontextmenu="return false;">


    <div class = "taskOverviewWrapper" id = "taskOverviewWrapper">
      <div style="text-align:center">
        <div id = "popup" class="popup" onclick="popUpGameIntro()" style="cursor: pointer; font-size:18px; font-family:verdana"><font color = "white">Introduction of the game
          <span class="popuptext" id="myPopup" style="font-size:12px; font-family:verdana"></span>
          <p id = "helper" class = "helper" style="font-size:12px; font-family:verdana">(click again to close it)</p>
        </div>
      </div>
    </div>

    <div id ="vertical-line" style="background-color: black; width: 5px; height:70%; position: absolute; left: 33.33%; top: 15%; z-index: 200;"> </div>
    <div id ="vertical-line2" style="background-color: black; width: 5px; height:70%; position: absolute; left: 56.66%; top: 15%; z-index: 200;"> </div>

    <p id ="user1" style="position: absolute; left: 20%; top: 15%; z-index: 2;font-size:18px; font-family:verdana"> Player 1 (You) </p>
    <p id ="user2" style="position: absolute; left: 60%; top: 15%; z-index: 2;font-size:18px; font-family:verdana"> Player 2 </p>

    <p id ="user3" style="position: absolute; left: 18%; top: 15%; z-index: 2;font-size:18px; font-family:verdana"> Player 1 (You) </p>
    <p id ="user4" style="position: absolute; left: 67%; top: 15%; z-index: 2;font-size:18px; font-family:verdana"> Player 2 </p>

    <div class = "gadgetWrapper">
      <small><small><small>
        <p class = "taskQ" id = "taskQ" style = "font-size: 30px; position: absolute; top: 0px; left: 0% "></p>
      </small></small></small>

      <div class = "instruction" id="instruction" onclick="instructiontime()" style="font-family:verdana; position: absolute; top: 9%">
        <label>
          Enter instructions	:
          <input id="txt_instruction" type="text" />
        </label>

        <button class = "buttonenter" id = "buttonEnter" onclick="send_user_message_to_server(); inputlength()">Enter</button>

        <div class = "numofwords" id="numofwords"></div>

      </div>

      <div class = "gestureToggle" id="gestureToggle"></div>
      <button class = "buttonStart" id="buttonStart" onclick="startGame()" >Start</button>

      <button class = "buttonEnd" id="buttonEnd" onclick="endGame();" >End</button>
      <p class = "gesture" id = "gesturecontext" style="font-size:20px; font-family:verdana">Gesture</p>
      <p class = "gestureCount" id = "gestureCount" style = "font-size: 40px; text-align: center">0</p>
      <p class = "movement" id = "movementcontext" style="font-size:20px; font-family:verdana">Movement</p>
      <p class = "MovementCount" id = "MovementCount" style = "font-size: 40px; text-align: center">0</p>
      <div class = "showChosen" id = "showChosen" style="font-size:12px; font-family:verdana; position: absolute; top: 10%; left: 60%"></div>

      <script type="text/javascript">
       document.getElementById("gesturecontext").style.visibility = "hidden";
       document.getElementById("movementcontext").style.visibility = "hidden";
       document.getElementById("gestureCount").style.visibility = "hidden";
       document.getElementById("MovementCount").style.visibility = "hidden";
      </script>

      <div id = "timer" style="font-size:24px; font-family:verdana; position: absolute; top: 10%; left: 30%"> Time: 3 minutes 0 seconds</div>
      <div id = "score" style="font-size:24px; font-family:verdana; width: 20%; text-align: center; position: absolute; top: 15%; left: 80%">
        Score
      </div>
      <div id = "scoreBox" style="text-align: center; border:#000 solid 5px; background-color: gray; width: 10%;height: 15%; position: absolute; top: 20%; left: 85%; font-size: 24px"></div>

    </div>

    <div class = "referenceLink" id = "referenceLink" style="font-family: Arial, Helvetica, sans-serif;"></div>

    <div id = "chatBox" style="height:30%; width:10%;border:5px solid #000;font:14px Arial, Helvetica, sans-serif; overflow:auto; bottom:25%; left: 85%; position: absolute; background-color: white; color: black;"></div>
    <!-- <script type="text/javascript">

         var recognizer = null;
         function recognize() {
         //speechRecognization interface is the heart of recognization API
         window.speechRecognition = window.speechRecognition || window.webkitSpeechRecognition || window.mozSpeechRecognition || window.webkitSpeechRecognition;
         if (window.speechRecognition == undefined) {
         alert("Speech Recogniztion API Not Supported");
         } else {
         //create a speechRecognization object
         recognizer = new speechRecognition();
         //If set to "false" then recognizer stops listening automatically when user stops speaking the first sentence.
         recognizer.continuous = true;
         //specify the language of speech. langauge must be in BCP 47 standard.
         recognizer.lang = "en-US";
         //it set to true then onresult callback is fired after every word spoken by the user. Otherwise after end of sentence.
         recognizer.interimResults = true;
         //fired when speech recognization starts listening.
         recognizer.onstart = function(){
         console.log("Recogniztion API started");
         }
         //fired everytime user stops speaking.
         recognizer.onresult = function(event){
         for (var count = event.resultIndex; count < event.results.length; count++) {
         if (event.results[count].isFinal) {
         console.log(event.results[count][0].transcript);
         }
         }
         }
         //fired when recognization is stopped manually or automatically.
         recognizer.onend = function() {
         recognizer = null;
         console.log("Recogniztion API stopped");
         recognize();
         }
         recognizer.start();
         }
         }
         function stopRecog() {
         if(recognizer != null) {
         //stop it manually
         recognizer.stop();
         console.log("Recognization API stopped");
         }
         }
         </script> -->

    <!-- <script>
         (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
         (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
         m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
         ga('create', 'UA-57883751-1', 'auto');
         ga('send', 'pageview');
         </script> -->

    <!-- <div class = "liveAudio">
         <a class = "buttonLike" href="Live Audio.html" onclick="window.open('Live Audio.html', 'newwindow', 'width=500, height=450'); return false;">Live Audio</a>
         </div> -->

    <script type="text/javascript">
     page_width = window.innerWidth;
     page_height = window.innerHeight;
     $("#taskQ").css('font-size', page_height * 0.04 + "px");
     $('#popup').css('font-size', page_height * 0.025 + "px");
     $('#timer').css('font-size', page_height * 0.025 + "px");
     $('#instruction').css('font-size', page_height * 0.025 + "px");
     $('#txt_instruction').css('font-size', page_height * 0.015 + "px");
     $('#buttonEnter').css('font-size', page_height * 0.015 + "px");
     document.getElementById('popup').style.top = "1%";
     document.getElementById('popup').style.right = "0%";
     $('#helper').css('font-size', page_height * 0.02 + "px");
     $('#buttonStart').css('font-size', page_height * 0.02 + "px");
     document.getElementById("buttonStart").style.width = page_width * 0.05 + "px";
     document.getElementById("buttonStart").style.height = page_height * 0.05 + "px";
     $('#buttonEnd').css('font-size', page_height * 0.02 + "px");
     document.getElementById("buttonEnd").style.width = page_width * 0.05 + "px";
     document.getElementById("buttonEnd").style.height = page_height * 0.05 + "px";
     $('#score').css('font-size', page_height * 0.02 + "px");
     $('#showChosen').css('font-size', page_height * 0.02 + "px");
     $('#chatBox').css('font-size', page_height * 0.025 + "px");
     $('#myPopup').css('font-size', page_height * 0.025 + "px");
     $('#myPopup').css('width', page_width * 0.3 + "px");
     $('#myPopup').css('height', page_height * 0.5 + "px");
    </script>


    <script type="text/javascript">
     function timecounter() {
       /* var countDownDate = new Date().getTime() + 1000 * 3 * 60 + 1000;*/
       var countDownDate = new Date().getTime() + 1000 * 3 * 60 * 1000 + 1000;
       var x = setInterval(function() {
         // Get todays date and time
         var now = new Date().getTime();

         // Find the distance between now an the count down date
         var distance = countDownDate - now;

         // Time calculations for days, hours, minutes and seconds
         var minutes = Math.floor((distance % (1000 * 60 * 60)) / 60000);
         var seconds = Math.floor((distance % (1000 * 60)) / 1000);

         // Output the result in an element with id="demo"
         if (minutes < 0) {
           clearInterval(x);
           if (am_i_player1) {
             endGame();
           }
         } else if (isGameEnd != true) {
           document.getElementById("timer").innerHTML = "Time: " + minutes + " minutes " + seconds + " seconds";
         }

       }, 1000);
     }
    </script>

    <script type="text/javascript">
     page_width = window.innerWidth;
     page_height = window.innerHeight;
     var line_height = Math.floor(page_height * 0.7) + 5;
     document.getElementById("vertical-line").style.height = line_height + "px";
     document.getElementById("vertical-line2").style.height = line_height + "px";
    </script>

    <!-- <script src="//webrtc.github.io/adapter/adapter-latest.js"></script> -->

    <!-- <script src="Recorderjs/recorder.js"></script>
         <script src="jsHtml5AudioRecorder.js"></script>
         <script src="js/init.js"></script> -->

    <script type="text/javascript">
     $("#txt_instruction").keyup(function(event){
       if(event.keyCode == 13){
         $("#buttonEnter").click();
       }
     });
    </script>

    <script type="text/javascript">
     initTaskID();
     blockColors = initColors(color, NumBlocks);
     flipColorArray = initColors(color, NumBlocks);
     blockLetters = initLetters(letters, NumBlocks);
     flipLetterArray = initLetters(letters, NumBlocks);
     initBlocks(blockColors, flipColorArray, blockLetters, flipLetterArray);
     writeBlockStyle(blockColors);
     let initialConfig = getInitialConfiguration(blockColors, flipColorArray, blockLetters, flipLetterArray);
     finalBlocks = getFinalConfiguration(initialConfig);

     initInstructions();
     setTaskHeader();
     setIntroduction(1);
     popUpGameIntro();

     function initBlocks(bColors, flipColors, bLetters, flipLtrs) {
       // Adds 1 to NumBlocks if the task is matching, ensuring an even
       // number of blocks to be matched.
       if (taskID == 1) {
         if (NumBlocks % 2 != 0) {
           NumBlocks++;
         }
       }
       var container = document.createElement("div");
       container.id = "container";
       container.ondblclick = function(e) {
         gestureCount++;
         var event = e || window.event;

         setGestureWithPosition(event.clientX, event.clientY, event);
         send_gesture_to_server();
       };
       container.style.fontSize = "4vmin";
       document.body.appendChild(container);
       var position_x = [];
       var position_y = [];
       var cur = 0;
       for (var i = 0; i < NumBlocks; i++) {
         var color_x = bColors[i];
         var l = Math.floor(Math.random() * bLetters.length);

         let horizNum = document.getElementById('container').getBoundingClientRect().right - 50 - 8 - 4 - 4;
         let horizDenom = document.getElementById('container').getBoundingClientRect().right * 100;
         var horizontal_percent = horizNum / horizDenom;

         let vertNum = document.getElementById('container').getBoundingClientRect().bottom - 50 - 8 - 4 - 4;
         let vertDenom = document.getElementById('container').getBoundingClientRect().bottom * 100;
         var vertical_percent = vertNum / vertDenom;

         let tLeft = Math.random() * Math.floor(horizontal_percent);
         let tTop = Math.random() * Math.floor(vertical_percent);

         if (i < bLetters.length) {
           l = i;
         }

         $("#container").append("<div class = \"block\" id =\"block"+i+"\" style=\"left: " + tLeft + "%; top: " + tTop + "%; background-color: " + color_x + "\"></div>");

         $("#block" + i).append("<span style=\"color: black\">" + bLetters[l] + "<span>");

         standard_info.push("block:" + i + " " + "standard position: (" + tLeft + "%, " + tTop + "%) color: " + color_x + " letters: " + bLetters[l] + " flipletters: " + flipLtrs[l]);
         goal_top.push(tTop);
         goal_left.push(tLeft);

         $("#block" + i).data("id", i);
         $("#block" + i).data("horizontal_percent", tLeft);
         $("#block" + i).data("vertical_percent", tTop);

         $("#block" + i).bind("contextmenu", function(e) {
           if (!((taskID == 3 || taskID == 0) && am_i_player1)) {
             var event = e || window.event;
             flipBlock('block' + $(this).data("id"), event, bLetters, bColors);
             send_flip_to_server('block' + $(this).data("id"));
             if (am_i_player1) {
               players.push("Human");
             } else {
               players.push("Robot");
             }

             var flipped_block_color = document.getElementById("block" + $(this).data("id")).style.backgroundColor;
             var flipped_block_letter = blockLetters[$(this).data("id")];

             block_actions.push("Block id: " + $(this).data("id") + " " + "Letter: " + flipped_block_letter + " " + "Color: " + flipped_block_color);
           }
         });
       }
     }

    </script>

    <div id = "disablingDiv">
      <div id = "freeze">
        We are currently waiting for another user to join so that we can connect you. Please be patient.
      </div>
    </div>


    <script type="text/javascript">
     for (var i = 0; i < NumBlocks; i++) {
       $("#block" + i).draggable({
       });
     }
    </script>

    <script type="text/javascript">
     for (var i = 0; i < NumBlocks; i++) {
       var blockid = document.getElementById('block'+i);
       if(blockid) {
         if(NumBlocks >= Object.keys(startPosMap).length){
           var pos = blockid.style;
           startPosMap['block'+i] = pos;
         }
       }
     }
    </script>

    <script type="text/javascript">
     document.getElementById("buttonEnd").disabled = true;
     document.getElementById("buttonEnter").disabled = true;
    </script>

    <script type="text/javascript">
     function submit() {
       var q1 = "", q2 = "", q3 = "", q4 = -1, q5 = -1, q6 = -1;
       // if (document.getElementById("41").checked) {
       // 	q4 = 1;
       // } else if (document.getElementById("42").checked) {
       // 	q4 = 2;
       // } else if (document.getElementById("43").checked) {
       // 	q4 = 3;
       // } else if (document.getElementById("44").checked) {
       // 	q4 = 4;
       // } else if (document.getElementById("45").checked) {
       // 	q4 = 5;
       // } else if (document.getElementById("46").checked) {
       // 	q4 = 6;
       // } else if (document.getElementById("47").checked) {
       // 	q4 = 7;
       // }

       // if (document.getElementById("51").checked) {
       // 	q5 = 1;
       // } else if (document.getElementById("52").checked) {
       // 	q5 = 2;
       // } else if (document.getElementById("53").checked) {
       // 	q5 = 3;
       // } else if (document.getElementById("54").checked) {
       // 	q5 = 4;
       // } else if (document.getElementById("55").checked) {
       // 	q5 = 5;
       // } else if (document.getElementById("56").checked) {
       // 	q5 = 6;
       // } else if (document.getElementById("57").checked) {
       // 	q5 = 7;
       // }

       // if (document.getElementById("61").checked) {
       // 	q6 = 1;
       // } else if (document.getElementById("62").checked) {
       // 	q6 = 2;
       // } else if (document.getElementById("63").checked) {
       // 	q6 = 3;
       // } else if (document.getElementById("64").checked) {
       // 	q6 = 4;
       // } else if (document.getElementById("65").checked) {
       // 	q6 = 5;
       // } else if (document.getElementById("66").checked) {
       // 	q6 = 6;
       // } else if (document.getElementById("67").checked) {
       // 	q6 = 7;
       // }

       q1 = document.getElementById("q1").value;
       // q2 = document.getElementById("q2").value;
       // q3 = document.getElementById("q3").value;

       document.body.innerHTML += "<p id = \"require\" style = \"font-family:verdana; visibility: hidden;\">Please finish all the questions.</p>";

       if (q1 == "") {
         document.getElementById("question1").style = "width: 680px; color: red; background-color:rgb(255,204,204);font-family:verdana";
         // if (q1 == "") {
         // 	document.getElementById("question1").style = "width: 680px; color: red; background-color:rgb(255,204,204);font-family:verdana";
         // } else {
         // 	document.getElementById("question1").style = "width: 680px; font-family:verdana";
         // 	document.getElementById("q1").innerText = q1;
         // }

         // if (q2 == "") {
         // 	document.getElementById("question2").style = "width: 535px; color: red; background-color:rgb(255,204,204);font-family:verdana";
         // } else {
         // 	document.getElementById("question2").style = "width: 535px; font-family:verdana";
         // 	document.getElementById("q2").innerText = q2;
         // }

         // if (q3 == "") {
         // 	document.getElementById("question3").style = "width: 1090px; color: red; background-color:rgb(255,204,204);font-family:verdana";
         // } else {
         // 	document.getElementById("question3").style = "width: 1090px; font-family:verdana";
         // 	document.getElementById("q3").innerText = q3;
         // }

         // if (q4 == -1) {
         // 	document.getElementById("question4").style = "width: 370px; color: red; background-color:rgb(255,204,204);font-family:verdana";
         // } else {
         // 	document.getElementById("question4").style = "width: 370px; font-family:verdana";
         // 	document.getElementById("4" + q4).checked = true;
         // }

         // if (q5 == -1) {
         // 	document.getElementById("question5").style = "width: 345px; color: red; background-color:rgb(255,204,204);font-family:verdana";
         // } else {
         // 	document.getElementById("question5").style = "width: 345px; font-family:verdana";
         // 	document.getElementById("5" + q5).checked = true;
         // }

         // if (q6 == -1) {
         // 	document.getElementById("question6").style = "width: 865px; color: red; background-color:rgb(255,204,204);font-family:verdana";
         // } else {
         // 	document.getElementById("question6").style = "width: 865px; font-family:verdana";
         // 	document.getElementById("6" + q6).checked = true;
         // }

         document.getElementById("require").style.visibility = "visible";

         document.getElementById("q1").innerText = q1;
         // document.getElementById("q2").innerText = q2;
         // document.getElementById("q3").innerText = q3;
       } else {
         try {
           socket.emit('send_survey_data_to_server', {
             q1: q1,
             q2: q2,
             q3: q3,
             q4: q4,
             q5: q5,
             q6: q6
           });
         } catch (err) {
           /* window.location.href = "server_down.html";*/
           redirects.pageDown(err);
         }
         window.location.href = "finalPage.html";
       }
     }
    </script>

    <!-- 	<iframe id="frmFile1" src="hs1.txt" onload="LoadFile();" style="display: none;"></iframe>
         <iframe id="frmFile2" src="hs2.txt" onload="LoadFile();" style="display: none;"></iframe>
         <iframe id="frmFile3" src="hs3.txt" onload="LoadFile();" style="display: none;"></iframe>
         <iframe id="frmFile4" src="hs4.txt" onload="LoadFile();" style="display: none;"></iframe>
         <script type="text/javascript">
         var score = [];
         function LoadFile() {
         var oFrame = document.getElementById("frmFile" + taskID);
         var strRawContents = oFrame.contentWindow.document.body.childNodes[0].innerHTML;
         while (strRawContents.indexOf("\r") >= 0)
         strRawContents = strRawContents.replace("\r", "");
         var arrLines = strRawContents.split("\n");
         console.log("File " + oFrame.src + " has " + arrLines.length + " lines");
         for (var i = 0; i < arrLines.length; i++) {
         var curLine = arrLines[i];
         score += curLine;
         console.log("Line #" + (i + 1) + " is: '" + curLine + "'");
         }
         }
         </script>
       -->
  </body>
</html>
